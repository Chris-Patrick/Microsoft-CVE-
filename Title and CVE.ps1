param(
    [string]$OutputFilePath = "C:\Users\Christopher\Desktop\MSRCOutput.csv"
)

Install-Module -Name MsrcSecurityUpdates -Force
Import-Module -Name MsrcSecurityUpdates -Force

# Define an array of month IDs
$Month = Read-Host 'Enter year and month to look through (EX: 2020-Jan or 2020-Jan, 2020-Feb)'
$MonthIDs = $Month.Split(',').Trim()

foreach ($monthID in $MonthIDs) {
    $summary = Get-MsrcCvrfDocument -ID $monthID | Get-MsrcCvrfCVESummary

    $cv = $summary | Where-Object { ($_."Maximum Severity Rating" -eq 'Important') -or ($_."Maximum Severity Rating" -eq 'Critical') }

    foreach ($cveSummary in $cv) {
        $cve = $cveSummary.CVE
        $description = $cveSummary.Description
        $maxSeverity = $cveSummary."Maximum Severity Rating"
        $impact = $cveSummary."Vulnerability Impact"
        $affectedSoftware = $cveSummary."Affected Software" | Where-Object { $_ -like "**" }

        if ($affectedSoftware) {
            $cvrfDocument = Get-MsrcCvrfDocument -ID $monthID
            $index = Get-MsrcCvrfExploitabilityIndex -Vulnerability $cvrfDocument.Vulnerability
            $vulnerability = $index | Where-Object { $_.CVE -eq $cve }

            if ($vulnerability) {
                $title = $vulnerability.Title

                $output = @"

Month: $monthID
CVE : $cve
Title: $title
Description : $description
Maximum Severity Rating : $maxSeverity
Vulnerability Impact : $impact
Affected Software : $affectedSoftware

"@

                Write-Output $output
                $output | Out-File -FilePath $OutputFilePath -Append
            }
        }
    }
}
